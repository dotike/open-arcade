{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "http://example.com/example.json",
    "type": "object",
    "title": "Asteroid Service Description Schema",
    "description": "The schema for an Asteroid Service Description",
    "default": {},
    "examples": [
        {
            "service": "nginxwoof",
            "description": "nginxwoof service",
            "version": 4,
            "component_type": "k8s",
            "containers": [
                {
                    "name": "woof",
                    "image": "nginx:1.14.2",
                    "readiness_check_path": "/",
                    "readiness_check_port": 8080,
                    "cpu": 1,
                    "cpu_limit": 2,
                    "mem": 1024,
                    "mem_limit": 2048,
                    "port_mappings": [
                        {
                            "port": 80,
                            "port_name": "http"
                        }
                    ]
                }
            ],
            "service_options": {
                "alerting": true,
                "desired_count": 1,
                "load_balanced": {
                    "public": true,
                    "private": true
                }
            }
        }
    ],
    "required": [
        "service",
        "description",
        "version",
        "component_type",
        "containers",
        "service_options"
    ],
    "properties": {
        "service": {
            "$id": "#/properties/service",
            "type": "string",
            "pattern": "^[a-z][-a-z0-9]{2,23}$",
            "title": "Service",
            "description": "A service namespace for the deployment (will be used for object names and labels in AWS/ECS)",
            "default": "",
            "examples": [
                "nginxwoof"
            ]
        },
        "description": {
            "$id": "#/properties/description",
            "type": "string",
            "title": "Description",
            "description": "A description of the service",
            "default": "",
            "examples": [
                "nginxwoof service"
            ]
        },
        "version": {
            "$id": "#/properties/version",
            "type": "integer",
            "title": "The version schema",
            "description": "The version of the Asteroid service that has been configured",
            "default": 0,
            "examples": [
                1
            ]
        },
        "component_type": {
            "$id": "#/properties/component_type",
            "type": "string",
            "title": "Component Type",
            "description": "The Component that this service is part of, like Kubernetes, ALB, RDS, Autoscale",
            "default": "",
            "examples": [
                "k8s"
            ]
        },
        "containers": {
            "$id": "#/properties/containers",
            "type": "array",
            "title": "Containers List",
            "description": "A list of the containers that make up the Asteroid service",
            "default": [],
            "examples": [
                [
                    {
                        "name": "woof",
                        "image": "nginx:1.14.2",
                        "readiness_check_path": "/",
                        "readiness_check_port": 8080,
                        "cpu": 1,
                        "cpu_limit": 2,
                        "mem": 1024,
                        "mem_limit": 2048,
                        "port_mappings": [
                            {
                                "port": 80,
                                "port_name": "http"
                            }
                        ]
                    }
                ]
            ],
            "additionalItems": true,
            "items": {
                "$id": "#/properties/containers/items",
                "anyOf": [
                    {
                        "$id": "#/properties/containers/items/anyOf/0",
                        "type": "object",
                        "title": "Container",
                        "description": "A definition of one container that is part of the Asteroid service",
                        "default": {},
                        "examples": [
                            {
                                "name": "woof",
                                "image": "nginx:1.14.2",
                                "readiness_check_path": "/",
                                "readiness_check_port": 8080,
                                "cpu": 1,
                                "cpu_limit": 2,
                                "mem": 1024,
                                "mem_limit": 2048,
                                "port_mappings": [
                                    {
                                        "port": 80,
                                        "port_name": "http"
                                    }
                                ]
                            }
                        ],
                        "required": [
                            "name",
                            "image",
                            "cpu",
                            "cpu_limit",
                            "mem",
                            "mem_limit",
                            "port_mappings"
                        ],
                        "properties": {
                            "name": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/name",
                                "type": "string",
                                "title": "Name",
                                "description": "The name of the container",
                                "default": "",
                                "examples": [
                                    "woof"
                                ]
                            },
                            "image": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/image",
                                "type": "string",
                                "title": "Image",
                                "description": "The Docker image for the container",
                                "default": "",
                                "examples": [
                                    "nginx:1.14.2"
                                ]
                            },
                            "readiness_check_path": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/readiness_check_path",
                                "type": "string",
                                "title": "Readiness Check Path",
                                "description": "The path to check for readiness of the container",
                                "default": "",
                                "examples": [
                                    "/"
                                ]
                            },
                            "readiness_check_port": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/readiness_check_port",
                                "type": "integer",
                                "title": "Readiness Check Port",
                                "description": "The port to check for readiness of the container",
                                "default": "",
                                "examples": [
                                    8080
                                ]
                            },
                            "cpu": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/cpu",
                                "type": "integer",
                                "title": "CPU",
                                "description": "The number of CPU shares required by this container",
                                "default": 1,
                                "examples": [
                                    1
                                ]
                            },
                            "cpu_limit": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/cpu_limit",
                                "type": "integer",
                                "title": "CPU Limit",
                                "description": "The maximum number of CPU shares that can be used if available",
                                "default": 1,
                                "examples": [
                                    2
                                ]
                            },
                            "mem": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/mem",
                                "type": "integer",
                                "title": "Mem",
                                "description": "The amount of memory required by this container in Bytes",
                                "default": 1024,
                                "examples": [
                                    1024
                                ]
                            },
                            "mem_limit": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/mem_limit",
                                "type": "integer",
                                "title": "Mem Limit",
                                "description": "The maximum amount of memory that can be used by this container in Bytes",
                                "default": 1024,
                                "examples": [
                                    2048
                                ]
                            },
                            "port_mappings": {
                                "$id": "#/properties/containers/items/anyOf/0/properties/port_mappings",
                                "type": "array",
                                "title": "Port Mappings",
                                "description": "An array of Docker port mappings for the container",
                                "default": [],
                                "examples": [
                                    [
                                        {
                                            "port": 80,
                                            "port_name": "http"
                                        }
                                    ]
                                ],
                                "additionalItems": true,
                                "items": {
                                    "$id": "#/properties/containers/items/anyOf/0/properties/port_mappings/items",
                                    "anyOf": [
                                        {
                                            "$id": "#/properties/containers/items/anyOf/0/properties/port_mappings/items/anyOf/0",
                                            "type": "object",
                                            "title": "Port Map",
                                            "description": "A port map entry in the Port Mappings array",
                                            "default": {},
                                            "examples": [
                                                {
                                                    "port": 80,
                                                    "port_name": "http"
                                                }
                                            ],
                                            "required": [
                                                "port",
                                                "port_name"
                                            ],
                                            "properties": {
                                                "port": {
                                                    "$id": "#/properties/containers/items/anyOf/0/properties/port_mappings/items/anyOf/0/properties/port",
                                                    "type": "integer",
                                                    "title": "Port",
                                                    "description": "The port outside the container to map into the container",
                                                    "default": 0,
                                                    "examples": [
                                                        80
                                                    ]
                                                },
                                                "port_name": {
                                                    "$id": "#/properties/containers/items/anyOf/0/properties/port_mappings/items/anyOf/0/properties/port_name",
                                                    "type": "string",
                                                    "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?",
                                                    "title": "Port name",
                                                    "description": "The internal container port name to map to",
                                                    "default": "",
                                                    "examples": [
                                                        "http"
                                                    ]
                                                }
                                            },
                                            "additionalProperties": true
                                        }
                                    ]
                                }
                            }
                        },
                        "additionalProperties": true
                    }
                ]
            }
        },
        "service_options": {
            "$id": "#/properties/service_options",
            "type": "object",
            "title": "Service Options",
            "description": "Any key/value that can be set on an Asteroid Service Description",
            "default": {},
            "examples": [
                {
                    "alerting": true,
                    "desired_count": 1,
                    "load_balanced": {
                        "public": true,
                        "private": true
                    },
                    "deployment_strategy": {
                        "type": "rolling",
                        "min_percent": 25,
                        "max_percent": 25
                    }
                }
            ],
            "required": [
                "desired_count",
                "load_balanced"
            ],
            "properties": {
                "alerting": {
                    "$id": "#/properties/service_options/properties/alerting",
                    "type": "boolean",
                    "title": "Alerting",
                    "description": "Whether or not alerting should be enabled for this service",
                    "default": false,
                    "examples": [
                        true
                    ]
                },
                "desired_count": {
                    "$id": "#/properties/service_options/properties/desired_count",
                    "type": "integer",
                    "title": "Desired Count",
                    "description": "How many copies of the service should be running",
                    "default": 0,
                    "examples": [
                        1
                    ]
                },
                "load_balanced": {
                    "$id": "#/properties/service_options/properties/load_balanced",
                    "type": "object",
                    "title": "Load balanced",
                    "description": "The options of the load balanced",
                    "default": {},
                    "examples": [
                        {
                            "public": true,
                            "private": true
                        }
                    ],
                    "required": [
                        "public",
                        "private"
                    ],
                    "properties": {
                        "public": {
                            "$id": "#/properties/service_options/properties/load_balanced/properties/public",
                            "type": "boolean",
                            "title": "Public",
                            "description": "Is this service public load-balanced?",
                            "default": false,
                            "examples": [
                                true
                            ]
                        },
                        "private": {
                            "$id": "#/properties/service_options/properties/load_balanced/properties/private",
                            "type": "boolean",
                            "title": "Private",
                            "description": "Is this service private load-balanced?",
                            "default": false,
                            "examples": [
                                true
                            ]
                        }
                    },
                    "additionalProperties": true
                },
                "deployment_strategy": {
                    "$id": "#/properties/service_options/properties/deployment_strategy",
                    "type": "object",
                    "title": "Deployment Strategy",
                    "description": "The options for the deployment strategy",
                    "default": {},
                    "examples": [
                        {
                            "type": "rolling",
                            "min_percent": 25,
                            "max_percent": 25
                        }
                    ],
                    "required": [
                        "type"
                    ],
                    "properties": {
                        "type": {
                            "$id": "#/properties/service_options/properties/deployment_strategy/properties/type",
                            "type": "string",
                            "pattern": "^(rolling|recreate)$",
                            "title": "Strategy type",
                            "description": "Rolling or recreate strategy",
                            "default": "rolling",
                            "examples": [
                                "rolling"
                            ]
                        },
                        "min_percent": {
                            "$id": "#/properties/service_options/properties/deployment_strategy/properties/min_percent",
                            "type": "integer",
                            "title": "Minimum percent",
                            "description": "What is the minimum rolling update percentage?",
                            "default": 25,
                            "examples": [
                                25
                            ]
                        },
                        "max_percent": {
                            "$id": "#/properties/service_options/properties/deployment_strategy/properties/max_percent",
                            "type": "integer",
                            "title": "Maximum percent",
                            "description": "What is the maximum rolling update percentage?",
                            "default": 25,
                            "examples": [
                                25
                            ]
                        }
                    },
                    "additionalProperties": true
                }
            },
            "additionalProperties": true
        }
    },
    "additionalProperties": true
}
